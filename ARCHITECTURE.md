# PlantSeg Integration - Visual Architecture

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER BROWSER                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         plant_segmentation.html (Frontend)              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  Upload Zone (Drag & Drop)                        â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - Multi-file selector                            â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - File list display                              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - Progress indicator                             â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  Results Panel (Right Side)                       â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - Image preview                                  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - Segmentation overlay                           â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - Confidence score                               â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - Class breakdown                                â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â†‘ â†“ HTTP                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                  â†“                  â†“
   GET /plant-      POST /api/        GET /api/
   segmentation    segment-plants    segment-status
        â”‚                  â”‚                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 web_app.py (Flask Backend)                      â”‚
â”‚                                                                   â”‚
â”‚  Route Handlers:                                                â”‚
â”‚  â”œâ”€ @app.route('/plant-segmentation')                          â”‚
â”‚  â”‚  â””â”€ return render_template('plant_segmentation.html')       â”‚
â”‚  â”‚                                                              â”‚
â”‚  â”œâ”€ @app.route('/api/segment-plants', methods=['POST'])        â”‚
â”‚  â”‚  â”œâ”€ Extract uploaded files                                  â”‚
â”‚  â”‚  â”œâ”€ Validate (max 10 images, file size)                     â”‚
â”‚  â”‚  â”œâ”€ Call plantseg_model.segment_batch()                     â”‚
â”‚  â”‚  â”œâ”€ Format results                                          â”‚
â”‚  â”‚  â””â”€ return jsonify(results)                                 â”‚
â”‚  â”‚                                                              â”‚
â”‚  â””â”€ @app.route('/api/segment-status', methods=['GET'])         â”‚
â”‚     â””â”€ return jsonify(model_status)                            â”‚
â”‚                                                                   â”‚
â”‚  Global State:                                                  â”‚
â”‚  â””â”€ plantseg_model = get_inferencer()                          â”‚
â”‚     MODEL_LOADED = plantseg_model.model is not None            â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â†“               â†“               â†“
      plantseg_inference.py (Python Module)
           â”‚               â”‚               â”‚
           â†“               â†“               â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ load_image   â”‚  â”‚ segment_      â”‚  â”‚ visualize_   â”‚
   â”‚ _from_bytes  â”‚  â”‚ image()       â”‚  â”‚ segmentation â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚               â”‚               â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  PlantSegInferencer Class     â”‚
           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
           â”‚  â”‚ __init__()              â”‚  â”‚
           â”‚  â”‚ segment_image()         â”‚  â”‚
           â”‚  â”‚ segment_batch()         â”‚  â”‚
           â”‚  â”‚ visualize_segmentation()â”‚  â”‚
           â”‚  â”‚ load_image_from_bytes() â”‚  â”‚
           â”‚  â”‚ image_to_base64()       â”‚  â”‚
           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
        â†“                  â†“                  â†“
    mmengine          mmseg.apis         PyTorch
    (Config)          (inference)       (Tensors)
        â”‚                  â”‚                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   PlantSeg Model (DeepLabV3)    â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
         â”‚  â”‚  ResNet101 Backbone       â”‚  â”‚
         â”‚  â”‚  - Feature extraction     â”‚  â”‚
         â”‚  â”‚  - Downsampling path      â”‚  â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â”‚               â†“                  â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
         â”‚  â”‚  ASPP Module              â”‚  â”‚
         â”‚  â”‚  - Multi-scale features   â”‚  â”‚
         â”‚  â”‚  - Atrous convolutions    â”‚  â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â”‚               â†“                  â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
         â”‚  â”‚  Decoder                  â”‚  â”‚
         â”‚  â”‚  - Feature upsampling     â”‚  â”‚
         â”‚  â”‚  - Skip connections       â”‚  â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â”‚               â†“                  â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
         â”‚  â”‚  Output Head              â”‚  â”‚
         â”‚  â”‚  - 4-class classifier     â”‚  â”‚
         â”‚  â”‚  - Softmax                â”‚  â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â”‚               â†“                  â”‚
         â”‚   Segmentation Mask (4 classes) â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†‘
                    GPU or CPU
```

---

## Data Flow Diagram

```
INPUT: Plant Image (JPEG/PNG/BMP/TIFF)
   â”‚
   â†“ (128Ã—128 pixels max)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Preprocessing           â”‚
â”‚ â”œâ”€ Resize to 128Ã—128    â”‚
â”‚ â”œâ”€ Convert to RGB       â”‚
â”‚ â”œâ”€ Normalize            â”‚
â”‚ â””â”€ Convert to tensor    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  PlantSeg Model                         â”‚
        â”‚  (DeepLabV3 + ResNet101)                â”‚
        â”‚                                         â”‚
        â”‚  Input: 128Ã—128Ã—3 tensor               â”‚
        â”‚  â”œâ”€ Backbone: Extract features         â”‚
        â”‚  â”œâ”€ ASPP: Multi-scale context          â”‚
        â”‚  â”œâ”€ Decoder: Upsample features         â”‚
        â”‚  â””â”€ Head: Predict 4 classes            â”‚
        â”‚                                         â”‚
        â”‚  Output: 128Ã—128Ã—4 logits              â”‚
        â”‚         (softmax â†’ class predictions)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                          â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Segmentation    â”‚    â”‚ Confidence Map   â”‚
   â”‚ Mask            â”‚    â”‚ (4 channels)     â”‚
   â”‚ 128Ã—128 array   â”‚    â”‚ Softmax outputs  â”‚
   â”‚ Values 0-3      â”‚    â”‚ 0.0-1.0 range    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                      â”‚
            â†“                      â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Post-processing                      â”‚
   â”‚ â”œâ”€ Extract unique classes            â”‚
   â”‚ â”œâ”€ Count pixels per class            â”‚
   â”‚ â”œâ”€ Calculate percentages             â”‚
   â”‚ â””â”€ Calculate confidence score        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Statistics   â”‚    â”‚ Visualization     â”‚
â”‚ â”œâ”€ Class 0:  â”‚    â”‚ â”œâ”€ Original image â”‚
â”‚ â”‚  count     â”‚    â”‚ â”œâ”€ Class 0: black â”‚
â”‚ â”‚  percent   â”‚    â”‚ â”œâ”€ Class 1: green â”‚
â”‚ â”œâ”€ Class 1:  â”‚    â”‚ â”œâ”€ Class 2: brown â”‚
â”‚ â”‚  count     â”‚    â”‚ â”œâ”€ Class 3: red   â”‚
â”‚ â”‚  percent   â”‚    â”‚ â””â”€ Blend 60/40    â”‚
â”‚ â”œâ”€ Class 2:  â”‚    â”‚                   â”‚
â”‚ â”‚  count     â”‚    â”‚ Output: PNG image â”‚
â”‚ â”‚  percent   â”‚    â”‚ (as base64)       â”‚
â”‚ â”œâ”€ Class 3:  â”‚    â”‚                   â”‚
â”‚ â”‚  count     â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ â”‚  percent   â”‚              â”‚
â”‚ â””â”€ Conf:     â”‚              â”‚
â”‚    0.95      â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
       â”‚                      â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ JSON Response    â”‚
         â”‚ {                â”‚
         â”‚  "filename":..   â”‚
         â”‚  "status":"..    â”‚
         â”‚  "visualization" â”‚
         â”‚  "seg_stats":..  â”‚
         â”‚  "class_labels"  â”‚
         â”‚  "confidence"    â”‚
         â”‚  "message"       â”‚
         â”‚ }                â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Frontend Display â”‚
         â”‚ â”œâ”€ Image+Overlay â”‚
         â”‚ â”œâ”€ Percentages   â”‚
         â”‚ â”œâ”€ Confidence    â”‚
         â”‚ â””â”€ Statistics    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

OUTPUT: Analysis Results Displayed to User
```

---

## Model Architecture Detail

```
                INPUT: 128Ã—128Ã—3
                        â”‚
                        â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  ResNet101 Backbone       â”‚
        â”‚                           â”‚
        â”‚  Layer 1 (64 filters)     â”‚
        â”‚  â”œâ”€ Conv 7Ã—7, stride 2    â”‚
        â”‚  â”œâ”€ Max Pool              â”‚
        â”‚  â”œâ”€ 3Ã—3 Res Blocks Ã—3     â”‚
        â”‚  â””â”€ â†’ 64Ã—64Ã—64            â”‚
        â”‚                           â”‚
        â”‚  Layer 2 (256 filters)    â”‚
        â”‚  â”œâ”€ 3Ã—3 Res Blocks Ã—4     â”‚
        â”‚  â”œâ”€ Stride 2              â”‚
        â”‚  â””â”€ â†’ 32Ã—32Ã—256           â”‚
        â”‚                           â”‚
        â”‚  Layer 3 (512 filters)    â”‚
        â”‚  â”œâ”€ 3Ã—3 Res Blocks Ã—23    â”‚
        â”‚  â”œâ”€ Stride 2              â”‚
        â”‚  â””â”€ â†’ 16Ã—16Ã—512           â”‚
        â”‚                           â”‚
        â”‚  Layer 4 (2048 filters)   â”‚
        â”‚  â”œâ”€ 3Ã—3 Res Blocks Ã—3     â”‚
        â”‚  â”œâ”€ Stride 2              â”‚
        â”‚  â””â”€ â†’ 8Ã—8Ã—2048            â”‚
        â”‚                           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†“â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  ASPP Module              â”‚
        â”‚  (Atrous Spatial Pyramid) â”‚
        â”‚                           â”‚
        â”‚  Input: 8Ã—8Ã—2048          â”‚
        â”‚                           â”‚
        â”‚  â”œâ”€ 1Ã—1 Conv (256)         â”‚
        â”‚  â”œâ”€ 3Ã—3 Atrous (rate=6)   â”‚
        â”‚  â”œâ”€ 3Ã—3 Atrous (rate=12)  â”‚
        â”‚  â”œâ”€ 3Ã—3 Atrous (rate=18)  â”‚
        â”‚  â”œâ”€ Image Pooling         â”‚
        â”‚  â”‚  â””â”€ Global Avg Pool     â”‚
        â”‚  â””â”€ Concat & Conv (256)   â”‚
        â”‚                           â”‚
        â”‚  Output: 8Ã—8Ã—256          â”‚
        â”‚                           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†“â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Decoder                  â”‚
        â”‚                           â”‚
        â”‚  Upsample Ã—4              â”‚
        â”‚  â”œâ”€ Bilinear interp       â”‚
        â”‚  â”œâ”€ Concat skip conn       â”‚
        â”‚  â”œâ”€ 3Ã—3 Conv Ã—2           â”‚
        â”‚  â””â”€ â†’ 32Ã—32Ã—256           â”‚
        â”‚                           â”‚
        â”‚  Upsample Ã—4              â”‚
        â”‚  â”œâ”€ Bilinear interp       â”‚
        â”‚  â”œâ”€ Concat skip conn       â”‚
        â”‚  â”œâ”€ 3Ã—3 Conv Ã—2           â”‚
        â”‚  â””â”€ â†’ 128Ã—128Ã—48          â”‚
        â”‚                           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†“â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Segmentation Head        â”‚
        â”‚                           â”‚
        â”‚  1Ã—1 Conv (4 classes)     â”‚
        â”‚  Softmax activation       â”‚
        â”‚                           â”‚
        â”‚  Output: 128Ã—128Ã—4        â”‚
        â”‚  (logits for each class)  â”‚
        â”‚                           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
        Segmentation Mask (128Ã—128Ã—4)
        Class Predictions (per pixel)
```

---

## Request-Response Cycle

```
CLIENT                          SERVER
  â”‚                               â”‚
  â”œâ”€ Upload Images â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚
  â”‚  (multipart/form-data)        â”‚
  â”‚  [file1.jpg, file2.jpg, ...]  â”‚
  â”‚                               â”‚
  â”‚                             [Processing]
  â”‚                               â”‚
  â”‚                          1. Load images
  â”‚                          2. Preprocess
  â”‚                          3. Forward pass
  â”‚                          4. Extract mask
  â”‚                          5. Visualize
  â”‚                          6. Calculate stats
  â”‚                          7. Format JSON
  â”‚                               â”‚
  â”‚  â† JSON Response â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  {                            â”‚
  â”‚    "total_images": 2,        â”‚
  â”‚    "processed": 2,           â”‚
  â”‚    "results": [              â”‚
  â”‚      {                        â”‚
  â”‚        "filename": "...",    â”‚
  â”‚        "status": "success", â”‚
  â”‚        "visualization": ".."|
  â”‚        "segmentation_stats":|
  â”‚        "class_labels": {...}â”‚
  â”‚        "confidence": 0.95,  â”‚
  â”‚        "message": "..."     â”‚
  â”‚      },                      â”‚
  â”‚      ...                     â”‚
  â”‚    ],                        â”‚
  â”‚    "errors": null           â”‚
  â”‚  }                           â”‚
  â”‚                               â”‚
  â”œâ”€ Display Results â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚
  â”‚  - Show images               â”‚
  â”‚  - Render overlays           â”‚
  â”‚  - Display stats             â”‚
  â”‚  - Show confidence           â”‚
  â”‚                               â”‚
  â””â”€ User Interaction            â”‚
     - Screenshot                â”‚
     - Export results            â”‚
     - Analyze further           â”‚
```

---

## File Organization

```
Root
â”‚
â”œâ”€â”€ web_app.py
â”‚   â”œâ”€ Flask app initialization
â”‚   â”œâ”€ Route definitions
â”‚   â”œâ”€ Model loading
â”‚   â””â”€ API endpoints
â”‚
â”œâ”€â”€ plantseg_inference.py  â† NEW
â”‚   â”œâ”€ PlantSegInferencer class
â”‚   â”œâ”€ Model management
â”‚   â””â”€ Inference logic
â”‚
â”œâ”€â”€ requirements.txt
â”‚   â”œâ”€ Flask
â”‚   â”œâ”€ PyTorch
â”‚   â”œâ”€ MMSeg
â”‚   â””â”€ Dependencies
â”‚
â”œâ”€â”€ templates/
â”‚   â”œâ”€ index.html (updated)
â”‚   â”œâ”€ plant_segmentation.html  â† NEW
â”‚   â”œâ”€ disease_detection.html
â”‚   â”œâ”€ terrain_quality.html
â”‚   â””â”€ plants_analysis.html
â”‚
â”œâ”€â”€ PlantSeg/  â† Model code
â”‚   â”œâ”€ mmseg/
â”‚   â”‚  â”œâ”€ apis/
â”‚   â”‚  â”‚  â”œâ”€ inference.py (used)
â”‚   â”‚  â”‚  â””â”€ mmseg_inferencer.py
â”‚   â”‚  â”œâ”€ models/
â”‚   â”‚  â”œâ”€ datasets/
â”‚   â”‚  â””â”€ ...
â”‚   â”œâ”€ configs/
â”‚   â”‚  â””â”€ deeplabv3/
â”‚   â”‚     â””â”€ deeplabv3_r101-160k_plantseg_binary-128x128.py
â”‚   â””â”€ tools/
â”‚
â”œâ”€â”€ data/
â”‚   â””â”€ plantsegv3/
â”‚       â”œâ”€ images/
â”‚       â”œâ”€ annotations/
â”‚       â””â”€ Metadatav2.csv
â”‚
â””â”€ Documentation
   â”œâ”€ INTEGRATION_SUMMARY.md  â† NEW
   â”œâ”€ PLANTSEG_INTEGRATION_GUIDE.md  â† NEW
   â””â”€ QUICK_START_SEGMENTATION.md  â† NEW
```

---

## Feature Comparison

```
BEFORE INTEGRATION          AFTER INTEGRATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Single image analysis      Multi-image batch processing
Basic image upload         Advanced drag & drop
Mock disease detection     Real AI segmentation
Simple heuristics          Deep learning model
No organ analysis          4-class organ segmentation
2D visualization          Color-coded masks
Basic stats               Detailed per-class stats
                          Confidence scores
                          GPU acceleration
                          API endpoints
                          Production ready
```

---

## System Specifications

```
HARDWARE REQUIREMENTS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Minimum (CPU Only):
â”œâ”€ 4GB RAM
â”œâ”€ 2+ CPU cores
â”œâ”€ 500MB disk (model)
â””â”€ Processing: ~2-5 sec/image

Recommended (GPU):
â”œâ”€ 4GB VRAM (GPU)
â”œâ”€ 8GB system RAM
â”œâ”€ NVIDIA CUDA compatible
â””â”€ Processing: ~0.5-1 sec/image

Maximum Throughput:
â”œâ”€ 10 images per batch
â”œâ”€ Batch processing time: 5-10 sec (GPU)
â”œâ”€ Concurrent batches: Depends on memory
â””â”€ API: Bottlenecked by model, not Flask
```

---

This architecture provides a **scalable, production-ready solution** for plant segmentation! ğŸŒ¿
